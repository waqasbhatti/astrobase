{% extends 'cpbase.html' %}

{% block pagecontent %}
<div class="row">

  <div class="col-sm-2 sidebar">

    <div class="row sidebar-list">
      <div class="col-sm-12">
        <h4 class="text-sm-center">Checkplots</h4>
        <ul id="checkplotlist" class="list-unstyled">
          {% for cplpath, cplbase, cplind in zip(project_checkplots, project_checkplotbasenames,project_checkplotindices) %}
          <li>
            <span class="object-status" data-fname="{{ cplpath }}"></span>
            <a class="checkplot-load" href="#"
               data-findex="{{ cplind }}"
               data-fname="{{ cplpath }}">
              {{ cplbase }}
            </a>
            <span class="object-disposition" data-fname="{{ cplpath }}"></span>
          </li>
          {% end %}
        </ul>
      </div>
    </div>

    <div class="row sidebar-controls">
      <div class="col-sm-12">
        <h4 class="text-sm-center">Project</h4>

        <!-- this is the status row -->
        <div class="row">
          <div class="col-sm-12">

          </div>
        </div>

        <!-- this is the save project row -->
        <div class="row">
          <div class="col-sm-12">
            <p>You may save all project data to CSV or JSON. This includes the
              following for each object:</p>
            <ul>
              <li>object information (coordinates, proper motion, magnitudes,
              and colors)</li>
              <li>variability tags, period, and epoch</li>
              <li>object tags and comments</li>
              <li>checkplot pickle file name and status</li>
            </ul>

            <p>Save to
              <button type="button" id="save-project-csv"
                      class="btn btn-outline-primary btn-sm">
                CSV
              </button> or
              <button type="button" id="save-project-json"
                      class="btn btn-outline-primary btn-sm">
                JSON
            </button></p>

          </div>
        </div>

        <!-- this is where downloads appear -->
        <div class="row">
          <div class="col-sm-12 download-center">

          </div>
        </div>

      </div>
    </div>

  </div>

  <div class="col-sm-10">

    <!-- instructions and nav bar go here -->
    <div class="row">
      <div class="col-sm-12 text-sm-center">
        <p>Use the <kbd>ctrl</kbd> + <kbd>&larr;</kbd> and the <kbd>ctrl</kbd>
          + <kbd>&rarr;</kbd> keys to move through the checkplot list. All
          updates are automatically saved to checkplot pickles on disk.<br>
          <a href="#" class="checkplot-prev">&lt;&lt; previous</a>
          | <span id="checkplot-current"></span> |
          <a href="#" class="checkplot-next">next &gt;&gt;</a>
        </p>
      </div>
    </div>

    <!-- first row: finderchart, objectinfo, varinfo, unphased LC -->
    <div class="row objectinfo-row">

      <div class="col-md-3 text-sm-center">
        <h4 id="objectid">objectid</h4>
        <h6 id="twomassid">twomassid</h6>
        <img class="img-fluid" id="finderchart">
      </div>

      <div class="col-md-4">

        <table class="table table-sm">
          <tr>
            <th>Observations</th>
            <td id="hatinfo">blah</td>
          </tr>
          <tr>
            <th>Coords and PM</th>
            <td id="coordspm">blah</td>
          </tr>
          <tr>
            <th>Magnitudes</th>
            <td id="mags">blah</td>
          </tr>
          <tr>
            <th>Colors</th>
            <td id="colors">blah</td>
          </tr>

        </table>

      </div>

      <div class="col-md-5">
        <img class="img-fluid" id="magseriesplot">
      </div>

    </div>

    <div class="row">

      <!-- this column contains variability controls -->
      <div class="col-sm-3">

        <div class="row">
          <div class="col-sm-12 text-sm-center">
            <strong>Is this a variable star?</strong>

            <div class="btn-group" data-toggle="buttons">
              <label class="btn btn-primary active" id="varcheck-yeslabel">
                <input type="radio" name="varcheck" value="no" class="varcheck"
                       id="varcheck-no" autocomplete="off" checked>
                No
              </label>
              <label class="btn btn-primary" id="varcheck-maybelabel">
                <input type="radio" name="varcheck" value="maybe" class="varcheck"
                       id="varcheck-maybe" autocomplete="off">
                Maybe
              </label>
              <label class="btn btn-primary" id="varcheck-nolabel">
                <input type="radio" name="varcheck" value="yes"  class="varcheck"
                       id="varcheck-yes" autocomplete="off">
                Yes
              </label>
            </div>

          </div>
        </div>

        <div class="row">
          <div class="col-sm-12">
            <div class="text-sm-center">
              <strong>Period and epoch</strong>
            </div>

            <input type="text" class="form-control"
                   name="objectperiod" id="objectperiod"
                   placeholder="period in days">
            <input type="text" class="form-control"
                   name="objectepoch" id="objectepoch"
                   placeholder="epoch in JD">
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12">
            <div class="text-sm-center">
              <strong>Variability tags</strong>
            </div>

            <input type="text" class="form-control"
                   name="vartags" id="vartags"
                   placeholder="variability tag 1, variability tag 2,...">
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12">
            <div class="text-sm-center">
              <strong>Object tags</strong>
            </div>

            <input type="text" class="form-control"
                   name="objecttags" id="objecttags"
                   placeholder="object tag 1, object tag 2,...">
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12">
            <div class="text-sm-center">
              <strong>Comments</strong>
            </div>

            <textarea class="form-control" id="objectcomments" rows="5">
            </textarea>
          </div>
        </div>

        <!-- this is the alert box -->
        <div class="row">
          <div class="col-sm-12 text-sm-center" id="alert-box">

          </div>
        </div>

      </div>

      <!-- contains the periodogram and phased LCs for each method-->
      <!-- each method gets their own column with as many rows as necessary -->
      <div class="col-sm-9">
        <div class="row phased-container">

        </div>
      </div>


    </div>


  </div>

</div>
{% end %}

{% block pagejs %}
<script src="{{ static_url("cpserver.js") }}"></script>

<script>

  $(document).ready(function() {
  // set up the controls
  cpv.action_setup();

  // load the first checkplot
  // fix the height for the sidebar
  var winheight = $(window).height();
  var docheight = $(document).height();
  $('.sidebar-controls').css({'height': docheight - winheight/2.0 + 'px'});

  });

  // this is to bind the left and right keys to the
  // next and previous object links
  $(document).keydown(function(event) {

  // ctrl+right keys pressed
  if (event.ctrlKey && event.which == 39) {
  event.preventDefault();
  console.log('moving to the next object')
  $('.checkplot-next').click();

  }

  // ctrl+left key pressed
  if (event.ctrlKey && event.which == 37) {
  console.log('moving to the prev object')
  event.preventDefault();
  $('.checkplot-prev').click();
  }

  });

</script>
{% end %}
